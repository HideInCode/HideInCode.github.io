# 网络

## 浏览器输入网址到展示内容发生了什么？

1. DNS 解析：浏览器查询 DNS，获取域名对应的 IP 地址：具体过程包括浏览器搜索⾃身的 DNS 缓存、搜索操 作系统的 DNS 缓存、读取本地的 Host ⽂件和向本地 DNS 服务器进⾏查询等。对于向本地 DNS 服务器进⾏ 查询，如果要查询的域名包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析(此解析具有 权威性)；如果要查询的域名不由本地 DNS 服务器区域解析，但该服务器已缓存了此⽹址映射关系，则调⽤这 个 IP 地址映射，完成域名解析（此解析不具有权威性）。如果本地域名服务器并未缓存该⽹址映射关系，那 么将根据其设置发起递归查询或者迭代查询；
2. TCP 连接：浏览器获得域名对应的 IP 地址以后，浏览器向服务器请求建⽴链接，发起三次握⼿； 
3. 发送 HTTP 请求：TCP 连接建⽴起来后，浏览器向服务器发送 HTTP 请求； 
4. 服务器处理请求并返回 HTTP 报⽂：服务器接收到这个请求，并根据路径参数映射到特定的请求处理器进⾏处 理，并将处理结果及相应的视图返回给浏览器； 
5. 浏览器解析渲染⻚⾯：浏览器解析并渲染视图，若遇到对 js ⽂件、css ⽂件及图⽚等静态资源的引⽤，则᯿复 上述步骤并向服务器请求这些资源；浏览器根据其请求到的资源、数据渲染⻚⾯，最终向⽤户呈现⼀个完整的 ⻚⾯。 
6. 连接结束。

## 三次握手

> 闭上眼睛再背一边

## 什么握手要三次？

需要客户端确认服务端的收发能力

也需要服务端确认客户端的收发能力

## 四次挥手

> 背

## 为什么要挥手四次？

需要确认断开

这里客户端最后一次发送后会进入TIME_WAIT状态，需要保证服务端收到ACK报文。

没有收到的话服务端会重新发送FIN报文。

## HTTP

### post与get的区别

1. 使用场景：get获取资源，post传输对象

2. 参数：get请求需要编码，post可以用中文。

3. 安全性：get是安全的，post不是。

4. 幂等性：get是幂等的，post不是。

5. 可缓存：

   1. 请求报文方法：get可缓存，post多数情况下不可缓存。
   2. 响应报文状态码：可缓存。
   3. 响应报文的Cache-Control首部字段没有指定不进行缓存。

   

### 不同版本的区别

- http1.0:不能长连接，只能短连接。打开需要connection:keep-alive;

- http1.1:可以长连接，多个http请求服务器也只能一个个响应。默认长连接，

- http2.0:多路复用，把报文分解成更小的二进制帧传送，不用http报文可以混合在一个TCP连接上传输。

### 与HTTPS的区别

- 开销：HTTPS要用到CA申请证书，一般免费证书很少，需要花钱。
- 资源消耗：HTTP明文传输；HTTPS加密传输，占用更多CPU和内存。
- 端口不同：HTTP80；HTTPS443；
- 安全性：HTTP简单的无状态协议；HTTPS是TSL+HTTP进行加密传输、身份认证的网络协议、更安全。

## HTTPS的工作流程

- 客户端发送加密规则给服务端告诉服务端要进行连接了。
- 服务器重中选出一套加密算法和hash算法以及自己的身份信息一证书的形式发送给浏览器。一般包括：服务器信息、加密公钥、整数的办法机构。
- 客户端收到证书后
  - 验证证书的合法性
  - 通过后，生成一串随机数，对证书的公钥进行加密。
  - 用约定好的hash算法计算握手信息，然后用生成的密钥加密，一起发给服务器。
- 服务接受到信息后
  - 用私钥解析处密码，用密码解析握手信息，验证hash和浏览器发来的是否一致
  - 使用密钥加密
- 如果hash一致，握手成功。

## TCP与UDP的区别

TCP：

1. 面向连接的运输层协议：传数据前必须先建立通道。
2. 一个TCP只能有两个端点，一一映射。
3. 可靠：不重、不漏、不错、有序。
4. 双全工通信。
5. 面向字节流。

UDP:

	1. 无连接传输层协议
	1. 尽力而为传输，不可靠。
	1. 面向报文的，对应用层的报文不合并、不拆分，保留报文边界。
	1. 没有拥塞机制，不会降低发送效率。
	1. 可以一对一、一对多、多对多。
	1. 首部开销小，只有8字节。

对比：

1. TCP可靠，UDP不可靠。
2. TCP面向连接，UDP无连接。
3. TCP有序，UDP无序。
4. TCP不保存数据边界，UDP保存数据边界。
5. TCP传输较慢。
6. TCP拥有流量控制和拥塞控制，UDP没有。
7. TCP比较重量级。
8. TCP首部20字节，UDP首部8字节。

## 五层网络协议

### 应用层

1. http
2. ftp：文件传输
3. smtp：简单邮件传输
4. dns：域名系统
5. ssh：安全外壳
6. dhcp：动态主机配置
7. telnet：远程登录

### 传输层

1. tcp：传输控制协议
2. udp：用户数据报文协议

### 网络层

1. ip：网际协议

2. arp：地址转换协议

   > IP与物理地址的映射，如果发送数据包时能找到此映射就直接使用对应MAC地址，否则就直接广播出去。

3. rarp：反向地址转换协议

4. icmp：Internet控制报文协议

5. igmp：Internet组管理协议

6. rip：路由信息协议

7. ospf：分布式链路状态协议

8. bgp：边界网关协议

### 数据链路层

1. arq：自动重传请求协议
2. csma/cd：停止等待协议
3. ppp：点对点协议

### 物理层

1. 中继器
2. 集线器
3. 网线
4. HUB



## 滑动窗口

## 粘包问题

TCP传输时，一个数据包包含了发送端发送的两个数据包信息，就叫粘包。

具体的可分为发送方粘包和接收方粘包。

+ 发送方粘包
  + TCP长连接时，当发送数据包过于小时，会启用Nagle算法，将小包和并发送，在缓冲区进行，发送出来就是粘包的。
+ 接收方粘包
  + 接收方接到数据，传输层的TCP会将数据包放到缓冲区，然后由应用层来获取。如果这时候应用层读取函数不能及时把缓冲区数据拿出来，那下一个数据又会补充道缓冲区末尾，形成粘包。
+ 如何解决粘包
  + 特殊字符控制
  + 在包头添加数据包的长度
  + 如果使用netty的话，可以有专门的编码器和解码器来解决这个问题。
  + UDP不会有粘包问题，UDP会丢包和乱序。

## 数字签名

为了避免数据在传输过程中被替换，⽐如⿊客修改了你的报⽂内容，但是你并不知道，所以我们让发送端做⼀个数 字签名，把数据的摘要消息进⾏⼀个加密，⽐如 MD5，得到⼀个签名，和数据⼀起发送。然后接收端把数据摘要 进⾏ MD5 加密，如果和签名⼀样，则说明数据确实是真的。

## 数字证书

对称加密中，双⽅使⽤公钥进⾏解密。虽然数字签名可以保证数据不被替换，但是数据是由公钥加密的，如果公钥 也被替换，则仍然可以伪造数据，因为⽤户不知道对⽅提供的公钥其实是假的。所以为了保证发送⽅的公钥是真 的，CA 证书机构会负责颁发⼀个证书，⾥⾯的公钥保证是真的，⽤户请求服务器时，服务器将证书发给⽤户，这 个证书是经由系统内置证书的备案的。

## 安全问题

1. sql注入
2. xss

