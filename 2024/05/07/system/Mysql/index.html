<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>HideInCode</title>
  <meta name="description" content="Mysql 伟大滴麦色可友，养活互联网企业的神器。  组成结构架构 server层 连接器：管理链接，权限验证 查询缓存：命中直接返回 分析器：词法分析，语法分析 优化器：执行计划生成，索引选择 执行器：操作引擎，返回结果   引擎层：操作引擎，返回结果。  redo-log WAL：Write-Ahead Logging crash-safe innodb 物理日志：在数据页上做的修改 循环写">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://hideincode.github.io/2024/05/07/system/Mysql/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Mysql 伟大滴麦色可友，养活互联网企业的神器。  组成结构架构 server层 连接器：管理链接，权限验证 查询缓存：命中直接返回 分析器：词法分析，语法分析 优化器：执行计划生成，索引选择 执行器：操作引擎，返回结果   引擎层：操作引擎，返回结果。  redo-log WAL：Write-Ahead Logging crash-safe innodb 物理日志：在数据页上做的修改 循环写">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-05-06T18:09:22.536Z">
<meta property="article:modified_time" content="2023-09-25T14:06:21.238Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="https://hideincode.github.io/2024/05/07/system/Mysql/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 7.2.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/HideInCode" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">HideInCode</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Backend</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">Repository</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/HideInCode" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">基础知识</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2/">开发部署</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%A7%A3%E9%A2%98%E6%8A%80%E5%B7%A7/">解题技巧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">问题排查</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algo/" rel="tag">algo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-pattern/" rel="tag">design pattern</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/system-design/" rel="tag">system design</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/algo/" style="font-size: 14px;">algo</a> <a href="/tags/design-pattern/" style="font-size: 13.5px;">design pattern</a> <a href="/tags/devops/" style="font-size: 13px;">devops</a> <a href="/tags/error/" style="font-size: 13px;">error</a> <a href="/tags/system-design/" style="font-size: 13px;">system design</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a><span class="archive-list-count">29</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2024/05/07/error/%E6%9C%BA%E5%99%A8%E9%97%AE%E9%A2%98/" class="title">(no title)</a>
              </p>
              <p class="item-date">
                <time datetime="2024-05-06T18:09:22.576Z" itemprop="datePublished">2024-05-07</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2024/05/07/devops/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE/" class="title">(no title)</a>
              </p>
              <p class="item-date">
                <time datetime="2024-05-06T18:09:22.572Z" itemprop="datePublished">2024-05-07</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2024/05/07/devops/ngxin/" class="title">(no title)</a>
              </p>
              <p class="item-date">
                <time datetime="2024-05-06T18:09:22.571Z" itemprop="datePublished">2024-05-07</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2024/05/07/devops/maven/" class="title">(no title)</a>
              </p>
              <p class="item-date">
                <time datetime="2024-05-06T18:09:22.570Z" itemprop="datePublished">2024-05-07</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2024/05/07/devops/linux/" class="title">(no title)</a>
              </p>
              <p class="item-date">
                <time datetime="2024-05-06T18:09:22.569Z" itemprop="datePublished">2024-05-07</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-system/Mysql" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2024/05/07/system/Mysql/" class="article-date">
	  <time datetime="2024-05-06T18:09:22.536Z" itemprop="datePublished">2024-05-07</time>
	</a>
</span>
        
        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2024/05/07/system/Mysql/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h1><blockquote>
<p>伟大滴麦色可友，养活互联网企业的神器。</p>
</blockquote>
<h2 id="组成结构"><a href="#组成结构" class="headerlink" title="组成结构"></a>组成结构</h2><h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><ul>
<li>server层<ul>
<li>连接器：管理链接，权限验证</li>
<li>查询缓存：命中直接返回</li>
<li>分析器：词法分析，语法分析</li>
<li>优化器：执行计划生成，索引选择</li>
<li>执行器：操作引擎，返回结果</li>
</ul>
</li>
<li>引擎层：操作引擎，返回结果。</li>
</ul>
<h3 id="redo-log"><a href="#redo-log" class="headerlink" title="redo-log"></a>redo-log</h3><ul>
<li>WAL：Write-Ahead Logging</li>
<li>crash-safe</li>
<li>innodb</li>
<li>物理日志：在数据页上做的修改</li>
<li>循环写</li>
</ul>
<h3 id="bin-log"><a href="#bin-log" class="headerlink" title="bin-log"></a>bin-log</h3><ul>
<li>server层，意味着所有引擎可以用</li>
<li>逻辑日志：语句原始逻辑，给ID&#x3D;2的字段c加1</li>
<li>追加写</li>
</ul>
<h3 id="两段式提交"><a href="#两段式提交" class="headerlink" title="两段式提交"></a>两段式提交</h3><ol>
<li>redolog进入prepare </li>
<li>写入binlog</li>
<li>提交事务</li>
</ol>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="B-树"><a href="#B-树" class="headerlink" title="B+树"></a>B+树</h3><ul>
<li><p>为什么选B+树？</p>
<ul>
<li>选了B+而不用B树，是因为B树在每个节点都存储数据，而B+树只会在叶子节点存储数据，所以B树IO会更频繁；数据库的索引是存在磁盘上的，当数据量大时，就不能全部加载到内存，只能逐一加载。</li>
</ul>
</li>
<li><p>基于B树实现，具有B树的平衡性；</p>
</li>
<li></li>
</ul>
<h3 id="索引特性"><a href="#索引特性" class="headerlink" title="索引特性"></a>索引特性</h3><ul>
<li>回表</li>
<li>索引覆盖</li>
<li>最左前缀原则</li>
<li>索引下推</li>
</ul>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="基本性质"><a href="#基本性质" class="headerlink" title="基本性质"></a>基本性质</h3><ol>
<li><p>原子性(Atomicity)</p>
<p>事务的所有操作只有成功和失败,操作期间不会去对数据库数据进行增删改操作,只记录操作,只有commit后才会去修改数据库的数据.事务失败就会rollback,数据不会有任何变化.</p>
</li>
<li><p>一致性（Consistency）</p>
<p>会话的双方要同时进行的DML操作,使得事务执行后数据库从一个一致性状态变到另一个一致性状态.</p>
</li>
<li><p>隔离性（Isolation）</p>
<p>事务之间是相互独立的两个对象,可以设置不同的隔离级别.</p>
</li>
<li><p>持久性（Durability）</p>
<p>事务终结的标志,提交后的事务将会永久性改变数据库的数据.</p>
</li>
</ol>
<h3 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h3><ol>
<li><p>read uncommitted -&gt;脏读</p>
<blockquote>
<p>这种隔离级别下 两个事务A B,A 没有提交数据 ,B 读到了A没有commit的数据(事务A正在操作的数据),这种数据叫做dirty data,这种行为叫做dirty read,一般只在理论上存在;	</p>
</blockquote>
</li>
<li><p>read committed -&gt; 不可重复度</p>
<blockquote>
<p>两个事务A B,A提交数据,B就读到A的数据,这种隔离级别的缺点就是不可重复度,即会话双方一方修改,一方读取,总是读取不到正确数据.<br>不可重复读的重点是修改.</p>
</blockquote>
</li>
<li><p>repeatable read -&gt; 幻读</p>
<blockquote>
<p>看这名字就知道就是来解决无法重复读的问题的.事务A开始时,不管事务BCD修改数据还是提交事务,都不会改变A读取的数据.<br>幻读:幻读是指当事务不是独立执行时发生的一种现象.事务A读取与搜索条件相匹配的若干行。<br>事务B以插入或删除行等方式来修改事务A的结果集，然后再提交。这时候事务A的用户发现表中还存在没有修改的数据行,就像出现了幻觉一样.</p>
</blockquote>
</li>
<li><p>serializable -&gt; 效率低</p>
<blockquote>
<p>不会出现上述问题,但由于进行了锁表操作,所以会降低吞吐量.<br>解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表.</p>
</blockquote>
</li>
</ol>
<p>	</p>
<h3 id="隔离的原理"><a href="#隔离的原理" class="headerlink" title="隔离的原理"></a>隔离的原理</h3><p>多版本并发控制MVCC</p>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><ul>
<li>一般全库逻辑备份时会用到</li>
<li>FlushTablesWithReadLock：库进入只读，阻塞DML，DDL，未提交的更新事务。故障时会释放锁。</li>
<li>set global readlonly&#x3D;true：用于主备库判断，故障时数据库不会释放锁。</li>
</ul>
<h3 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h3><ul>
<li>lock tables … read&#x2F;write 客户端断开自动释放</li>
<li>元数据锁：metadata lock：访问表时自动开启，修改表结构时加MDL锁；</li>
<li>给小表安全加字段：<ul>
<li>kill长事务</li>
<li>alter table语句加等待时间，过期放弃。</li>
</ul>
</li>
</ul>
<h3 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h3><ul>
<li>innodb特有</li>
<li>死锁与死锁检测：<ul>
<li>循环依赖导致</li>
<li>等到超时：innodb_lock_wait_timeout</li>
<li>主动检测：innodb_deadlock_detect&#x3D;on，缺点影响性能。</li>
<li>减小主动检测的性能影响：<ul>
<li>控制并发度，一行只能十个线程，但是客户端过多还是不行。</li>
<li>设计层面优化，把记录拆分多条，然后算多个记录的和。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="常见表结构设计"><a href="#常见表结构设计" class="headerlink" title="常见表结构设计"></a>常见表结构设计</h2><h3 id="表设计三大范式"><a href="#表设计三大范式" class="headerlink" title="表设计三大范式"></a>表设计三大范式</h3><blockquote>
<p>范式只是一种参考，实际生产要考虑索引问题、联表查询效率问题。</p>
</blockquote>
<ol>
<li><p>列不可分</p>
<ul>
<li>一列不可有两种属性</li>
<li>比如地址可分为省、市、区三个字段</li>
</ul>
</li>
<li><p>在范式1的基础上，所有的非主键字段要<strong>完全依赖</strong>主键，不是依赖主键的某一部分（针对联合主键）</p>
<ul>
<li><p>出现了<strong>多对多</strong>关系</p>
</li>
<li><p>例如一张表存学生和课程</p>
<ul>
<li>新增一个学生，该学生还没有选课，因此就不能新增。新增老师同理。</li>
</ul>
</li>
<li><p>一个表只描述一件事情</p>
</li>
</ul>
</li>
<li><p>在范式2基础上，所有非主键字段和主键字段<strong>没有传递依赖</strong></p>
<ul>
<li>出现<strong>一对多</strong>关系</li>
<li>例如一张表存老师和学生<ul>
<li>修改老师职称时要改很多数据（修改一影响多）</li>
<li>没人选该老师课程时，该老师职称记录会被删除。（多没了代表了一也没了，不合理）</li>
<li>新老师还没指定职称，那么职称不知如何保存。</li>
</ul>
</li>
<li>一对多出现时考虑：一和多分成两张表，多表存一表主键，</li>
</ul>
</li>
</ol>
<h2 id="SQL命令使用常识"><a href="#SQL命令使用常识" class="headerlink" title="SQL命令使用常识"></a>SQL命令使用常识</h2><ul>
<li>count：count(字段)&lt;count(id)&lt;count(1)约等count(*)</li>
<li>order by：<ul>
<li>sort_buffer_size：排序内存大小，如果太小就利用临时文件排序。</li>
<li>rowid排序：如果要返回字段过多，只取出排序字段。</li>
<li>如果内存够，就用内存排序。</li>
</ul>
</li>
<li>join:<ul>
<li>正确选择驱动表，驱动表走全表扫描，被驱动表走数索引。</li>
<li>使用join语句，性能比强行拆成多个单表执行SQL语句的性能好。</li>
<li>如果使用join，需要使用小表做驱动。</li>
</ul>
</li>
</ul>
<h2 id="常见疑难杂症"><a href="#常见疑难杂症" class="headerlink" title="常见疑难杂症"></a>常见疑难杂症</h2><ul>
<li><p>普通索引和唯一索引怎么选？</p>
<ul>
<li><p>读：区别不大</p>
</li>
<li><p>写：</p>
<ul>
<li>change buffer：缓存更新操作，唯一索引不能用，只有普通索引可以用。如果更新后马上查询，不要用这个。redolog节省随机写磁盘的io消耗，changebuffer节省对应读的io消耗。</li>
<li>唯一索引：判断冲突</li>
<li>普通索引：更新记录在changebuffer</li>
</ul>
</li>
</ul>
</li>
<li><p>怎么给字符串加索引？</p>
</li>
<li><p>mysql为什么会抖一下？</p>
<ul>
<li>内存脏页：内存数据和磁盘数据不一样时，内存页就是脏页。</li>
</ul>
</li>
<li><p>为什么表数据删除一半，表文件大小不变？</p>
<ul>
<li>delete结果不会变，alter table才会改变。</li>
</ul>
</li>
<li><p>为什么逻辑相同的语句，性能缺差异巨大？</p>
<ul>
<li><p>条件字段函数操作</p>
</li>
<li><p>隐式类型转换</p>
</li>
<li><p>隐式字符编码转换</p>
</li>
</ul>
</li>
<li><p>查一行也很慢？</p>
<ul>
<li>查询长时间不返回：锁表了，通过show processlist查看状态。</li>
<li>等DML锁：show processlist查看wait for table metadata lock</li>
<li>等flush</li>
</ul>
</li>
<li><p>幻读有什么问题吗？</p>
</li>
<li><p>鸩止渴的提高性能？</p>
<ul>
<li><p>先处理占着链接但是不工作的线程</p>
</li>
<li><p>减少链接过程的消耗</p>
</li>
<li><p>慢查询性能问题</p>
<ul>
<li>索引没有设计好</li>
<li>语句没写好</li>
</ul>
</li>
<li><p>QPS突增问题</p>
</li>
</ul>
</li>
<li><p>如何保证数据不丢？</p>
<ul>
<li><p>binglog写入机制</p>
</li>
<li><p>redolog写入机制</p>
</li>
</ul>
</li>
<li><p>保证主备一致？</p>
</li>
<li><p>涉及到binlog可选</p>
<ul>
<li>statement</li>
<li>row</li>
<li>mixed</li>
</ul>
</li>
<li><p>怎么保证高可用？</p>
<ul>
<li><p>主备延迟</p>
<ul>
<li><p>备库机器差劲</p>
</li>
<li><p>备库压力大</p>
</li>
<li><p>大事务</p>
</li>
</ul>
</li>
<li><p>可靠性优先策略</p>
</li>
</ul>
</li>
<li><p>备库为什么会延迟几个小时？</p>
<ol>
<li><p>5.5版本并行复制策略</p>
<ol>
<li>按表分发</li>
<li>按行分发</li>
</ol>
</li>
<li><p>5.7并行复制策略</p>
</li>
<li><p>5.7.22并行复制策略</p>
</li>
</ol>
</li>
<li><p>主库出问题，从库怎么办？</p>
<ol>
<li><p>基于位点的主备切换</p>
</li>
<li><p>基于GTID的主备切换</p>
</li>
</ol>
</li>
<li><p>读写分离有哪些坑？</p>
</li>
</ul>
<ol>
<li>主备延迟导致的读写分离<ol>
<li>强制走主库</li>
<li>sleep</li>
<li>判断主备无延迟<ol>
<li>通过seconds_behind_master</li>
<li>位点比对</li>
<li>GTID</li>
</ol>
</li>
<li>semi-sync半同步复制</li>
</ol>
</li>
</ol>
<ul>
<li><p>判断数据库是不是出问题？</p>
<ol>
<li><p>select 1</p>
</li>
<li><p>查表判断</p>
</li>
<li><p>更新判断</p>
</li>
<li><p>内部统计</p>
</li>
</ol>
</li>
<li><p>误删数据怎么办？</p>
<ol>
<li><p>删除行</p>
</li>
<li><p>删除库&#x2F;表</p>
</li>
</ol>
</li>
<li><p>为什么有些命令kill不掉？</p>
<ol>
<li><p>kill query + 线程id</p>
</li>
<li><p>kill connection + 线程id</p>
</li>
<li><p>关于客户端的误解：表多就慢</p>
</li>
</ol>
</li>
<li><p>查大量数据会不会打爆内存？</p>
<ol>
<li><p>全表扫描对server层影响：先装net_buffer，满了就输出，边读边发。</p>
</li>
<li><p>全表扫描对innodb的影响</p>
</li>
</ol>
</li>
<li><p>为什么临时表可以重名？</p>
<ol>
<li><p>create temporary table 创建临时表</p>
</li>
<li><p>创建的临时表只能被当前session访问</p>
</li>
<li><p>可以与普通表重名，优先访问临时表，show tables不显示临时表。</p>
</li>
</ol>
</li>
<li><p>何时会用到临时表？</p>
<ol>
<li><p>union执行流程</p>
</li>
<li><p>group by</p>
</li>
</ol>
</li>
<li><p>innodb虽然厉害，那么memory还用不用？</p>
<ol>
<li><p>innodb索引组织表</p>
<ol>
<li>有序存放</li>
<li>有空位也会写入新位置</li>
<li>数据位置变化只要修改主键索引</li>
<li>通过主键就一次，普通索引要两次</li>
</ol>
</li>
<li><p>memory堆组织表</p>
<ol>
<li>按照写入顺序存放<ol>
<li>有空位就插入</li>
<li>位置变化要修改所有索引</li>
<li>查找时一视同仁</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><p>怎么快速复制一张表？</p>
<ol>
<li><p>sqldump方法：生成包含insert语句的方法，可以在where参数里面加过滤，不能join</p>
</li>
<li><p>导出csv</p>
</li>
<li><p>物理拷贝：最快、必须全表拷贝、需要到机器上拷贝，在用户登录数据库的场景下无法使用，都得是innodb</p>
</li>
</ol>
</li>
<li><p>grant之后要跟着flushprivileges吗？</p>
</li>
<li><p>要不要分区分表？</p>
</li>
<li><p>自增ID用完怎么办？</p>
<ol>
<li><p>表定义自增id：用完会冲突，可以增加范围biginit unsigned。</p>
<ol>
<li><p>innodb系统自增row_id：</p>
<ol>
<li>不显示指定主键时，系统隐式自带。</li>
<li>用完就会重零开始覆盖</li>
</ol>
</li>
<li><p>xid</p>
<ol>
<li>作用于事务：这是redo log和binglog配合使用的id</li>
<li>不要在binlog重复</li>
</ol>
</li>
</ol>
</li>
<li><p>innodb trx_id：每次随着mysql重启会被保存起来。</p>
</li>
<li><p>thread_id</p>
</li>
</ol>
</li>
</ul>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p><strong>初始化SQL</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dept;</span><br><span class="line">drop table if exists salgrade;</span><br><span class="line">drop table if exists emp; </span><br><span class="line">create table dept(		</span><br><span class="line">    deptno int(10) primary key,		</span><br><span class="line">    dname varchar(14),		</span><br><span class="line">    loc varchar(13)		</span><br><span class="line">);		</span><br><span class="line">create table salgrade(		</span><br><span class="line">    grade int(11),		</span><br><span class="line">    losal int(11),		</span><br><span class="line">    hisal int(11)		</span><br><span class="line">);		</span><br><span class="line">create table emp(		</span><br><span class="line">    empno int(4) primary key,		</span><br><span class="line">    ename varchar(10),		</span><br><span class="line">    job varchar(9),		</span><br><span class="line">    mgr int(4),		</span><br><span class="line">    hiredate date,		</span><br><span class="line">    sal double(7,2),		</span><br><span class="line">    comm double(7,2),		</span><br><span class="line">    deptno int(2)		</span><br><span class="line">);		</span><br><span class="line">insert into dept(deptno,dname,loc) values(10,&#x27;ACCOUNTING&#x27;,&#x27;NEW YORK&#x27;);</span><br><span class="line">insert into dept(deptno,dname,loc) values(20,&#x27;RESEARCHING&#x27;,&#x27;DALLAS&#x27;);</span><br><span class="line">insert into dept(deptno,dname,loc) values(30,&#x27;SALES&#x27;,&#x27;CHICAGO&#x27;);</span><br><span class="line">insert into dept(deptno,dname,loc) values(40,&#x27;OPERATIONS&#x27;,&#x27;BOSTON&#x27;); </span><br><span class="line"></span><br><span class="line">insert into salgrade(grade,losal,hisal) values(1,700,1200);</span><br><span class="line">insert into salgrade(grade,losal,hisal) values(2,1201,1400);</span><br><span class="line">insert into salgrade(grade,losal,hisal) values(3,1401,2000);</span><br><span class="line">insert into salgrade(grade,losal,hisal) values(4,2001,3000);</span><br><span class="line">insert into salgrade(grade,losal,hisal) values(5,3001,5000); </span><br><span class="line"></span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7369,&#x27;SIMITH&#x27;,&#x27;CLERK&#x27;,7902,&#x27;1980-12-17&#x27;,800,null,20);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7499,&#x27;ALLEN&#x27;,&#x27;SALESMAN&#x27;,7698,&#x27;1981-02-20&#x27;,1600,300,30);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7521,&#x27;WARD&#x27;,&#x27;SALESMAN&#x27;,7698,&#x27;1981-02-22&#x27;,1250,500,30);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7566,&#x27;JONES&#x27;,&#x27;MANAGER&#x27;,7839,&#x27;1981-04-02&#x27;,2975,null,20);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7654,&#x27;MARTIN&#x27;,&#x27;SALESMAN&#x27;,7698,&#x27;1981-09-28&#x27;,1250,1400,30);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7698,&#x27;BLAKE&#x27;,&#x27;MANAGER&#x27;,7839,&#x27;1981-05-01&#x27;,2850,null,30);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7782,&#x27;CLARK&#x27;,&#x27;MANAGER&#x27;,7839,&#x27;1981-06-09&#x27;,2450,null,10);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7788,&#x27;SCOTT&#x27;,&#x27;ANALYST&#x27;,7566,&#x27;1987-04-19&#x27;,3000,null,20);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7839,&#x27;KING&#x27;,&#x27;PRESIDENT&#x27;,null,&#x27;1981-11-17&#x27;,5000,null,10);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7844,&#x27;TURNER&#x27;,&#x27;SALESMAN&#x27;,7698,&#x27;1981-09-08&#x27;,1500,null,30);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7876,&#x27;ADAMS&#x27;,&#x27;CLERK&#x27;,7788,&#x27;1987-05-23&#x27;,1100,null,20);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7900,&#x27;JAMES&#x27;,&#x27;CLERK&#x27;,7698,&#x27;1981-12-03&#x27;,950,null,30);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7902,&#x27;FORD&#x27;,&#x27;ANALYST&#x27;,7566,&#x27;1981-12-03&#x27;,3000,null,20);</span><br><span class="line">insert into emp(empno,ename,job,mgr,hiredate,sal,comm,deptno)	values(7934,&#x27;MILLER&#x27;,&#x27;CLERK&#x27;,7782,&#x27;1982-01-23&#x27;,1300,null,10);	</span><br></pre></td></tr></table></figure>



<ol>
<li><p>每个部门薪水最高的人员名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	e.ename NAME,</span><br><span class="line">	t.maxsal,</span><br><span class="line">	d.dname deptname </span><br><span class="line">FROM</span><br><span class="line">	emp e</span><br><span class="line">	JOIN ( SELECT deptno, max( sal ) maxsal FROM emp GROUP BY deptno ) t ON t.deptno = e.deptno </span><br><span class="line">	AND t.maxsal = e.sal</span><br><span class="line">	JOIN dept d ON t.deptno = d.deptno;</span><br></pre></td></tr></table></figure>
</li>
<li><p>薪水在部门平均水平以上的人</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">	e.ename name,e.deptno,e.sal</span><br><span class="line">from </span><br><span class="line">	emp e join (select deptno,avg(sal) avgsal from emp group by deptno) t </span><br><span class="line">on e.sal &gt; t.avgsal and t.deptno=e.deptno;</span><br></pre></td></tr></table></figure>
</li>
<li><p>取得部门中的平均薪水等级(所有人)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">	t.deptno deptno,s.grade grade </span><br><span class="line">from </span><br><span class="line">	(select deptno, avg(sal) avgsal from emp group by deptno) t join salgrade s on t.avgsal between losal and hisal;</span><br></pre></td></tr></table></figure>
</li>
<li><p>取得部门中所有人的薪水等级,并对部门薪水等级求平均</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select t.dept, avg(t.grade) avg_grade from (select e.deptno dept,e.ename name,e.sal salary,s.grade grade from emp e join salgrade s on e.sal between s.losal and hisal) t group by t.dept;</span><br></pre></td></tr></table></figure>

<p>也可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select e.deptno dept,avg(s.grade) from emp e join salgrade s on e.sal between s.losal and hisal group by e.deptno;</span><br></pre></td></tr></table></figure>
</li>
<li><p>不用聚合函数max,取得最高薪水,使用两种方法解决</p>
<ol>
<li><code>select ename,sal from emp order by sal desc limit 1;</code></li>
<li><code>select sal from emp where sal not in (select distinct a.sal sal_a from emp a join emp b on a.sal &lt; b.sal);</code></li>
</ol>
</li>
<li><p>取得平均薪水最高的部门的部门编号(2种方案)</p>
<blockquote>
<p>可能有相等数据,取第一个可能会错误,所以要根据deptno找到重复的max</p>
</blockquote>
<ol>
<li><pre><code class="mysql">select 
    deptno,avg(sal) as avgsal
from 
    emp 
group by 
    deptno
having 
    avg(sal) = (select avg(sal) avgsal from emp group by deptno order by avgsal desc limit 1);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 聚合函数max</span><br><span class="line"></span><br><span class="line">   ```mysql</span><br><span class="line">   select </span><br><span class="line">   	deptno,avg(sal) avgsal</span><br><span class="line">   from </span><br><span class="line">   	emp</span><br><span class="line">   group by </span><br><span class="line">   	deptno</span><br><span class="line">   having</span><br><span class="line">   	avg(sal) = (select max(t.avgsal) from (select deptno,avg(sal) avgsal from emp group by deptno ) t);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
<li><p>取得平均薪水最高的部门的部门名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">	d.dname,m.avgsal</span><br><span class="line">from</span><br><span class="line">	dept d</span><br><span class="line">join </span><br><span class="line">	(select </span><br><span class="line">	deptno,avg(sal) avgsal</span><br><span class="line">from </span><br><span class="line">	emp</span><br><span class="line">group by </span><br><span class="line">	deptno</span><br><span class="line">having</span><br><span class="line">	avg(sal) = (select max(t.avgsal) from (select deptno,avg(sal) avgsal from emp group by deptno ) t)) m</span><br><span class="line">	on m.deptno=d.deptno;</span><br></pre></td></tr></table></figure>


</li>
<li><p>求平均薪水的等级最高的部门名称</p>
</li>
<li><p>求各个部门平均薪水的等级(结果只有部门名称.平均薪水,等级三个字段)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select t.avgsal,s.grade,t.dname from </span><br><span class="line">(select d.dname dname,avg(e.sal) avgsal from emp e join dept d on e.deptno=d.deptno group by dname) t</span><br><span class="line">join salgrade s</span><br><span class="line">on t.avgsal between s.losal and s.hisal;</span><br></pre></td></tr></table></figure>


</li>
<li><p>获取最高等级值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select max(s.grade) from </span><br><span class="line">(select deptno,avg(sal) avgsal from emp group by deptno) t</span><br><span class="line">join salgrade s</span><br><span class="line">on t.avgsal between s.losal and s.hisal;</span><br></pre></td></tr></table></figure>


</li>
<li><p>联合上两张表 给出avgsal,dname,grade,满足平均值为最大值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select t.avgsal,s.grade,t.dname from </span><br><span class="line">(select d.dname dname,avg(e.sal) avgsal from emp e join dept d on e.deptno=d.deptno group by dname) t</span><br><span class="line">join salgrade s</span><br><span class="line">on t.avgsal between s.losal and s.hisal</span><br><span class="line">where</span><br><span class="line">	s.grade=(select max(s.grade) from </span><br><span class="line">(select deptno,avg(sal) avgsal from emp group by deptno) t</span><br><span class="line">join salgrade s</span><br><span class="line">on t.avgsal between s.losal and s.hisal);</span><br></pre></td></tr></table></figure>


</li>
<li><p>取得比<strong>普通员工</strong>(员工代码没有在mgr字段上出现的)的<strong>最高薪水</strong>还要高的姓名</p>
<ol>
<li><p>先找到普通员工(注意not in (不能有null))<br><code>select * from emp where empno  not in (select distinct mgr from emp where mgr is not null);</code></p>
<pre><code>     2. 找出普通员工最高薪水
</code></pre>
<p><code>select max(sal) from emp where empno not in (select distinct mgr from emp where mgr is not null);</code></p>
</li>
<li><p>找出薪水高于1600</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select ename ,sal from emp </span><br><span class="line">where sal &gt; (select max(sal) from emp where empno not in (select distinct mgr from emp where mgr is not null));</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<p>​			补充学习: <code>select ename,sal,(case job when &#39;manager&#39; then sal * 0.8 when &#39;salesman&#39; then sal*1.5 end) newsal from emp;</code></p>
<ol start="9">
<li><p>取得薪水最高的前五</p>
</li>
<li><p>取得薪水最高的第六名到第十名</p>
</li>
<li><p>取得最后入职的5名员工</p>
</li>
<li><p>取得每个薪水等级有多少个员工	</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select e.ename, e.sal, s.grade from emp e join salgrade s on e.sal between s.losal and s.hisal;</span><br><span class="line">select t.sgrade ,count(*) from (select e.ename, e.sal, s.grade sgrade from emp e join salgrade s on e.sal between s.losal and s.hisal) t group by t.sgrade;</span><br><span class="line">select count(*), s.grade </span><br><span class="line">from emp e join salgrade s on e.sal between s.losal and s.hisal</span><br><span class="line">group by s.grade;</span><br></pre></td></tr></table></figure>
</li>
<li><p>列出所有员工和领导的名字<br> 列出所有的领导,not in 领导就是员工(自连接)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select distinct a.empno,a.ename,b.mgr from emp a join emp b on a.empno =b.mgr;-- 所有的领导</span><br><span class="line">select ename from emp where ename not in (select distinct a.ename from emp a join emp b on a.empno =b.mgr);</span><br></pre></td></tr></table></figure>
</li>
<li><p>找出入职日期早于其直接领导的员工编号,姓名,部门名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	t.adno,</span><br><span class="line">	t.aname,</span><br><span class="line">	d.dname </span><br><span class="line">FROM</span><br><span class="line">	(</span><br><span class="line">              SELECT</span><br><span class="line">              a.empno eno,</span><br><span class="line">              a.ename aname,</span><br><span class="line">              a.hiredate ahdate,</span><br><span class="line">              a.deptno adno,</span><br><span class="line">              b.hiredate bhdate </span><br><span class="line">              FROM</span><br><span class="line">              emp a</span><br><span class="line">              LEFT JOIN emp b ON a.mgr = b.empno </span><br><span class="line">          ) t</span><br><span class="line">	JOIN dept d ON d.deptno = t.adno </span><br><span class="line">WHERE</span><br><span class="line">	t.ahdate &lt; t.bhdate</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 老司机做法选出员工直接老板和各自的入职日期,通过where筛选</span><br><span class="line">	select a.empno aempno, a.ename aename,d.dname ddname, b.empno bempno, b.ename bename</span><br><span class="line">	from emp a join emp b on a.mgr = b.empno join dept d on d.deptno = a.deptno	</span><br><span class="line">	where a.hiredate&lt;b.hiredate;		</span><br></pre></td></tr></table></figure>


</li>
<li><p>列出部门名称和这些部门员工信息,同时列出没有员工的部门<br><code>select d.dname,e.* from emp e right join dept d on e.deptno=d.deptno order by d.dname asc;</code></p>
</li>
<li><p>列出至少有5个员工的所有部门(什么这里select后可以有groupby没有的东西)<br><code>select dept.*,emp.deptno,count(*) from emp join dept on emp.deptno = dept.deptno group by dept.deptno having count(*) &gt;=5;</code></p>
</li>
<li><p>列出薪资比simith高的员工的个人信息<br><code>select * from emp where sal &gt; (select sal from emp where ename=&#39;simith&#39;);</code></p>
</li>
<li><p>列出所有clerk职位的员工姓名,部门名称,部门人数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select e.ename ename,d.dname ddname, t.countall from emp e join dept d on d.deptno = e.deptno join (select e.deptno, count(*) countall from  emp e  group by e.deptno) t on t.deptno = d.deptno</span><br><span class="line">where job=&#x27;clerk&#x27; ;</span><br><span class="line">select e.deptno, count(*) countall from  emp e group by e.deptno;</span><br></pre></td></tr></table></figure>

<p>​		</p>
</li>
<li><p>列出最低薪资大于1500的各工种及从事此工作的全部员工人数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select job,min(sal) minsal,count(*) from emp group by job having minsal &gt;1500;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在不知道部门编号的情况下列出sales部门的员工姓名<br> 这题又理解错误,emp的deptno是知道的,只有dept表中deptno不知道</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select deptno from dept where dname=&#x27;sales&#x27;;</span><br><span class="line">select ename from emp where deptno = ( select deptno from dept where dname=&#x27;sales&#x27;);</span><br></pre></td></tr></table></figure>



<ol start="21">
<li><p>列出薪资高于公司平均薪资的所有员工,所在部门,上级领导,员工的工资等级</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- 注意用全连接找出king的信息</span><br><span class="line">SELECT</span><br><span class="line">	e.mgr,</span><br><span class="line">	e.ename,</span><br><span class="line">	e.deptno,</span><br><span class="line">	e2.ename boss,</span><br><span class="line">	d.dname,</span><br><span class="line">	s.grade </span><br><span class="line">FROM</span><br><span class="line">	emp e</span><br><span class="line">	LEFT JOIN emp e2 ON e.mgr = e2.empno</span><br><span class="line">	JOIN dept d ON d.deptno = e.deptno</span><br><span class="line">	JOIN salgrade s ON e.sal BETWEEN s.losal </span><br><span class="line">	AND s.hisal </span><br><span class="line">WHERE</span><br><span class="line">	e.sal &gt; ( SELECT avg( sal ) FROM emp );</span><br></pre></td></tr></table></figure>


</li>
<li><p>列出与scott从事相同工作的所有员工及其部门名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	job </span><br><span class="line">FROM</span><br><span class="line">	emp </span><br><span class="line">WHERE</span><br><span class="line">	ename = &#x27;scott&#x27;;</span><br><span class="line">SELECT</span><br><span class="line">	e.ename,</span><br><span class="line">	d.dname,</span><br><span class="line">	e.job </span><br><span class="line">FROM</span><br><span class="line">	emp e</span><br><span class="line">	JOIN dept d ON e.deptno = d.deptno </span><br><span class="line">WHERE</span><br><span class="line">	job = ( SELECT job FROM emp WHERE ename = &#x27;scott&#x27; );</span><br></pre></td></tr></table></figure>


</li>
<li><p>列出薪资等于部门30中员工的薪资的其他员工的姓名和薪金</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT</span><br><span class="line">	sal </span><br><span class="line">FROM</span><br><span class="line">	emp </span><br><span class="line">WHERE</span><br><span class="line">	deptno = 30;</span><br><span class="line">	</span><br><span class="line">SELECT</span><br><span class="line">	ename,</span><br><span class="line">	sal </span><br><span class="line">FROM</span><br><span class="line">	emp </span><br><span class="line">WHERE</span><br><span class="line">	( sal IN ( SELECT DISTINCT sal FROM emp WHERE deptno = 30 ) ) 	AND deptno &lt;&gt; 30;</span><br></pre></td></tr></table></figure>


</li>
<li><p>列出薪资高于部门30中员工的薪资的其他员工的姓名和薪金</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	ename,</span><br><span class="line">	sal </span><br><span class="line">FROM</span><br><span class="line">	emp </span><br><span class="line">WHERE</span><br><span class="line">	sal &gt; ( SELECT max( t.sal ) FROM ( SELECT DISTINCT sal FROM emp WHERE deptno = 30 ) t );</span><br></pre></td></tr></table></figure>

<ol start="25">
<li>列出在每个部门工作的员工数量,平均工资和平均服务期限(工龄)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 所有、每个这类关键字，一般需要全连接</span><br><span class="line">SELECT</span><br><span class="line">	e.deptno,</span><br><span class="line">	count( e.ename ) totalmember,</span><br><span class="line">	IFNULL(avg( sal ) ,0) avgsal,</span><br><span class="line">	IFNULL(avg(	( ( TO_DAYS( now( ) ) - TO_DAYS( hiredate ) ) / 356 )),0) year</span><br><span class="line">FROM</span><br><span class="line">	emp e</span><br><span class="line">	RIGHT JOIN dept d ON e.deptno = d.deptno </span><br><span class="line">GROUP BY</span><br><span class="line">	deptno;</span><br></pre></td></tr></table></figure>



<ol start="26">
<li><p>列出所有员工的姓名,部门名称,工资<br><code>select e.ename,d.dname,e.sal from emp e join dept d on e.deptno=d.deptno;</code></p>
</li>
<li><p>列出所有部门的详细信息和人数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select d.deptno,d.dnae,d.loc,count(e.ename) from emp e right join dept d on e.deptno=d.deptno group by d.deptno,d.dname,d.loc;</span><br></pre></td></tr></table></figure>


</li>
<li><p>列出各个工作岗位最低工资和符合最低工资的人姓名<br>(判空与去重)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	t.job,</span><br><span class="line">	e.ename,</span><br><span class="line">	t.minsal </span><br><span class="line">FROM</span><br><span class="line">	emp e</span><br><span class="line">	JOIN ( SELECT job, min( sal ) minsal FROM emp GROUP BY job ) t ON e.job = t.job </span><br><span class="line">	AND e.sal = t.minsal </span><br><span class="line">ORDER BY</span><br><span class="line">	t.minsal ASC;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取各个部门mgr的最低薪资</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	deptno,</span><br><span class="line">	min( sal ) minsal </span><br><span class="line">FROM</span><br><span class="line">	emp </span><br><span class="line">	where</span><br><span class="line">	job=&#x27;manager&#x27;</span><br><span class="line">GROUP BY</span><br><span class="line">	deptno;</span><br></pre></td></tr></table></figure>

<ol start="30">
<li><p>取出所有员工年薪,由低到高排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	ename,</span><br><span class="line">	sal * 12+ ifnull( comm, 0 ) yearsal </span><br><span class="line">FROM</span><br><span class="line">	emp </span><br><span class="line">ORDER BY</span><br><span class="line">	yearsal ASC;</span><br></pre></td></tr></table></figure>
</li>
<li><p>取出员工领导薪水超过3000的员工名称和领导名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	e.ename,</span><br><span class="line">	e2.ename leader</span><br><span class="line">FROM</span><br><span class="line">	emp e JOIN emp e2 ON e.mgr = e2.empno AND e2.sal &gt; 3000;</span><br></pre></td></tr></table></figure>


</li>
<li><p>取出含有s的部门,给出此部门的工资合计,部门人数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	d.dname empname,</span><br><span class="line">	count( e.ename ) totalpersons,</span><br><span class="line">	SUM( ifnull( e.sal, 0 ) ) sumsal </span><br><span class="line">FROM</span><br><span class="line">	emp e</span><br><span class="line">	RIGHT JOIN dept d ON e.deptno = d.deptno </span><br><span class="line">WHERE</span><br><span class="line">	d.dname LIKE &#x27;%s%&#x27; </span><br><span class="line">GROUP BY</span><br><span class="line">	d.dname;</span><br></pre></td></tr></table></figure>
</li>
<li><p>给任职超过30年的人加薪10%;<br>工作时间计算公式(年)<br>(( TO_DAYS( now( ) ) - TO_DAYS( hiredate ) ) &#x2F; 365 ) year</p>
</li>
</ol>
<p>create table emp_bak as select * from emp;</p>
<ol start="34">
<li>面试一下</li>
</ol>
<p><strong>初始化数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists s;</span><br><span class="line">drop table if exists c;</span><br><span class="line">drop table if exists sc; </span><br><span class="line">create table s(		</span><br><span class="line">    sno int(10) primary key,		</span><br><span class="line">    sname varchar(14)		</span><br><span class="line">);		</span><br><span class="line">create table c(		</span><br><span class="line">    cno int(10) primary key,		</span><br><span class="line">    cname varchar(14),		</span><br><span class="line">    cteacher varchar(14)		</span><br><span class="line">);		</span><br><span class="line">create table sc(		</span><br><span class="line">    sno int(10),  	</span><br><span class="line">    cno int(10),		</span><br><span class="line">    scgrade int(10),		</span><br><span class="line">    primary key(sno,cno)		</span><br><span class="line">);		</span><br><span class="line">insert into s(sno,sname) values(1,&#x27;a&#x27;);</span><br><span class="line">insert into s(sno,sname) values(2,&#x27;b&#x27;);</span><br><span class="line">insert into s(sno,sname) values(3,&#x27;c&#x27;);</span><br><span class="line">insert into s(sno,sname) values(4,&#x27;d&#x27;); </span><br><span class="line"></span><br><span class="line">insert into c(cno,cname,cteacher) values(1,&#x27;java&#x27;,&#x27;王老师&#x27;);</span><br><span class="line">insert into c(cno,cname,cteacher) values(2,&#x27;C++&#x27;,&#x27;张老师&#x27;);</span><br><span class="line">insert into c(cno,cname,cteacher) values(3,&#x27;C#&#x27;,&#x27;李老师&#x27;);</span><br><span class="line">insert into c(cno,cname,cteacher) values(4,&#x27;mysql&#x27;,&#x27;周老师&#x27;);</span><br><span class="line">insert into c(cno,cname,cteacher) values(5,&#x27;oracle&#x27;,&#x27;黎明&#x27;); </span><br><span class="line"></span><br><span class="line">insert into sc(sno,cno,scgrade) values(1,1,50);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(1,2,50);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(1,3,50);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(2,2,80);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(2,3,70);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(2,4,59);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(3,1,60);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(3,2,61);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(3,3,99);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(3,4,100);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(3,5,52);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(4,3,82);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(4,4,99);</span><br><span class="line">insert into sc(sno,cno,scgrade) values(4,5,40);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>有3个表s(学生表),c(课程表),sc(学生选课表)<br>s(sno,sname) 代表 (学号,姓名)<br>c(cno,cname,cteacher) 代表(课号,课名,教师)<br>sc(sno,cno,scgrade)代表 (学号,课号,成绩)</p>
</blockquote>
<ol>
<li><p>找出没选过”黎明”老师的所有学生姓名<br>1. 肯定要用补集求解,所以先求黎明苏所在表的相关信息<br>select cno,cname from c where cteacher&#x3D;’黎明’;<br>2. 选了黎明的人<br>select sno from sc where cno &#x3D; (select cno from c where cteacher&#x3D;’黎明’);<br> 3. 没选黎明的人<br> select sname from s where sno not in (select sno from sc where cno &#x3D; (select cno from c where cteacher&#x3D;’黎明’))</p>
</li>
<li><p>列出2门以上(含2门) 不及格学生姓名及他的所有成绩的平均成绩<br> 1. 先选出2门不及格的学生<br><br> <code>    select sno from sc where scgrade &lt; 60 group by sno having count(*)&gt;=2 ;</code><br><br> 2. 连接s取姓名<br><br> <code>select s.sname from sc join s on sc.sno = s.sno where sc.scgrade &lt; 60 group by s.sname having count(*)&gt;=2 ;</code><br><br> 3. 算出每个学生的平均成绩跟不及格的姓名连接(下面这个做法不行,因为其他成绩已经过滤掉了,只会求不及格成绩的平均线)<br>   <code>select s.sname name, avg(sc.scgrade) avgscore from sc join s on sc.sno = s.sno where sc.scgrade &lt; 60 group by s.sname having count(*)&gt;=2 ;</code></p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 求出所有学生平均成绩</span><br><span class="line">select sc.sno,avg(sc.scgrade) avgscore from sc group  by sc.sno;</span><br><span class="line">select sno,avg(sc.scgrade) avgscore from sc group  by sno;</span><br><span class="line"></span><br><span class="line">	SELECT</span><br><span class="line">	t1.NAME NAME,</span><br><span class="line">	t2.avgscore avgscore </span><br><span class="line">FROM</span><br><span class="line">	(</span><br><span class="line">	SELECT</span><br><span class="line">		s.sname NAME,</span><br><span class="line">		s.sno sno </span><br><span class="line">	FROM</span><br><span class="line">		sc</span><br><span class="line">		JOIN s ON sc.sno = s.sno </span><br><span class="line">	WHERE</span><br><span class="line">		sc.scgrade &lt; 60 GROUP BY NAME, sno HAVING count( * ) &gt;= 2 </span><br><span class="line">	) t1</span><br><span class="line">	JOIN ( SELECT sc.sno sno, avg( sc.scgrade ) avgscore FROM sc GROUP BY sc.sno ) t2 ON t1.sno = t2.sno </span><br><span class="line">GROUP BY</span><br><span class="line">	t1.sno;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>即学过1号课程又学过2号课程所有学生的姓名<br>1. 学过1号课程的所有学生(sname,cno)<br><code>select s.sname sname,sc.cno cno from sc join s on s.sno=sc.sno where cno = 1;</code><br>2. 学过2号课程的所有学生(sname,cno)<br><code>select s.sname sname,sc.cno cno from sc join s on s.sno=sc.sno where cno=2;</code><br>3. 求交集</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select t1.sname sname from (select s.sname sname,sc.cno cno from sc </span><br><span class="line">join s on s.sno=sc.sno where cno = 1) t1 </span><br><span class="line">join (select s.sname sname,sc.cno cno from sc join s on s.sno=sc.sno where cno=2) t2 on t1.sname = t2.sname;</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong><br><strong>作业到此完成,所有的问题都可分成小问题来拼出来,这个过程中除了注意sql的语法,mysql的特殊语法,还要考虑判空,去重,是否要全连接等.</strong><br><strong>查询数据的思路</strong></p>
<ol>
<li>我需要哪些字段?这些字段分别在那些表里?这些表靠什么连接?</li>
<li>涉及多表字段(自连接也算) 要先分开查询,查询时要注意判空与去重,以及选用合适的过滤方法和分组函数.</li>
<li>连接时选用内还是外连接,是要用增加查询字段,进行子查询,还是表连接要先后判断一下.</li>
</ol>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://hideincode.github.io/2024/05/07/system/Mysql/" title="" target="_blank" rel="external">https://hideincode.github.io/2024/05/07/system/Mysql/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/HideInCode" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/HideInCode" target="_blank"><span class="text-dark">HideInCode</span><small class="ml-1x">Backend</small></a></h3>
        <div>后端玩家</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2024/05/07/system/MyBatis/" title="(no title)"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2024/05/07/system/ElasticSearch/" title="(no title)"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>Maybe you could buy me a cup of coffee.</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/" alt="Scan Qrcode" title="Scan" />
              </div>
              <p class="text-muted mv">Scan this qrcode</p>
              <p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/" alt="Scan Qrcode" title="Scan" />
              </div>
              <p class="text-muted mv">Scan this qrcode</p>
              <p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/HideInCode" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>